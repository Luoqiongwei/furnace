<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‚¼é‡‘æœ¯å£«çš„ç†”ç‚‰ - æœºåˆ¶åŸå‹</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a2e;
            color: #eee;
            padding: 20px;
            min-height: 100vh;
        }
        
        h1 {
            text-align: center;
            color: #e94560;
            margin-bottom: 10px;
        }
        
        .subtitle {
            text-align: center;
            color: #888;
            margin-bottom: 30px;
            font-size: 14px;
        }
        
        .main-container {
            display: flex;
            gap: 30px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        /* å·¦ä¾§ï¼šææ–™åº“ */
        .materials-panel {
            width: 280px;
            background: #16213e;
            border-radius: 10px;
            padding: 15px;
        }
        
        .panel-title {
            font-size: 16px;
            color: #0f3460;
            background: #e94560;
            padding: 8px 12px;
            border-radius: 5px;
            margin-bottom: 15px;
        }
        
        .material-category {
            margin-bottom: 15px;
        }
        
        .category-name {
            font-size: 12px;
            color: #888;
            margin-bottom: 8px;
            text-transform: uppercase;
        }
        
        .materials-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }
        
        .material-card {
            aspect-ratio: 1;
            background: #0f3460;
            border: 2px solid #1a1a2e;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 11px;
            text-align: center;
            padding: 4px;
        }
        
        .material-card:hover {
            border-color: #e94560;
            transform: scale(1.05);
        }
        
        .material-card.selected {
            border-color: #e94560;
            background: #e94560;
            color: #fff;
        }
        
        .material-icon {
            font-size: 20px;
            margin-bottom: 2px;
        }
        
        .material-name {
            font-size: 10px;
            line-height: 1.2;
        }
        
        /* ä¸­é—´ï¼šåˆæˆé‡œåŒºåŸŸ */
        .reactors-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .reactor {
            background: #16213e;
            border-radius: 10px;
            padding: 20px;
            border: 2px solid #0f3460;
        }
        
        .reactor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .reactor-name {
            font-size: 18px;
            color: #e94560;
        }
        
        .reactor-info {
            font-size: 12px;
            color: #888;
        }
        
        .slots-container {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            align-items: center;
        }
        
        .input-slots {
            display: flex;
            gap: 10px;
        }
        
        .slot {
            width: 80px;
            height: 80px;
            background: #0f3460;
            border: 2px dashed #533483;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        
        .slot:hover {
            border-color: #e94560;
        }
        
        .slot.filled {
            border-style: solid;
            border-color: #e94560;
            background: #1a1a2e;
        }
        
        .slot-label {
            position: absolute;
            top: -20px;
            font-size: 10px;
            color: #888;
        }
        
        .slot-content {
            font-size: 24px;
        }
        
        .slot-material {
            font-size: 10px;
            margin-top: 4px;
            text-align: center;
        }
        
        .arrow {
            font-size: 24px;
            color: #e94560;
        }
        
        .output-slots {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            max-width: 200px;
        }
        
        .output-slot {
            width: 60px;
            height: 60px;
            background: #1a1a2e;
            border: 2px solid #533483;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 10px;
        }
        
        .output-slot.has-result {
            border-color: #4ecca3;
            background: #0f3460;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .param-control {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #0f3460;
            padding: 8px 12px;
            border-radius: 5px;
        }
        
        .param-label {
            font-size: 12px;
            color: #888;
        }
        
        .param-buttons {
            display: flex;
            gap: 4px;
        }
        
        .param-btn {
            padding: 4px 10px;
            font-size: 11px;
            background: #1a1a2e;
            border: 1px solid #533483;
            color: #eee;
            cursor: pointer;
            border-radius: 3px;
        }
        
        .param-btn:hover {
            border-color: #e94560;
        }
        
        .param-btn.active {
            background: #e94560;
            border-color: #e94560;
        }
        
        .action-btn {
            padding: 10px 25px;
            font-size: 14px;
            background: #e94560;
            border: none;
            color: #fff;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.2s;
        }
        
        .action-btn:hover {
            background: #ff6b6b;
        }
        
        .action-btn:disabled {
            background: #533483;
            cursor: not-allowed;
        }
        
        .clear-btn {
            padding: 8px 15px;
            font-size: 12px;
            background: #533483;
            border: none;
            color: #eee;
            cursor: pointer;
            border-radius: 5px;
        }
        
        /* å³ä¾§ï¼šé…æ–¹å›¾é‰´ */
        .recipes-panel {
            width: 350px;
            background: #16213e;
            border-radius: 10px;
            padding: 15px;
        }
        
        .recipes-filter {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 5px 12px;
            font-size: 11px;
            background: #0f3460;
            border: 1px solid #533483;
            color: #eee;
            cursor: pointer;
            border-radius: 3px;
        }
        
        .filter-btn.active {
            background: #e94560;
            border-color: #e94560;
        }
        
        .recipes-list {
            max-height: 600px;
            overflow-y: auto;
        }
        
        .recipe-item {
            background: #0f3460;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            border-left: 3px solid #533483;
        }
        
        .recipe-item.discovered {
            border-left-color: #4ecca3;
        }
        
        .recipe-item.undiscovered {
            opacity: 0.6;
        }
        
        .recipe-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .recipe-name {
            font-size: 13px;
            font-weight: bold;
        }
        
        .recipe-probability {
            font-size: 11px;
            color: #4ecca3;
        }
        
        .recipe-formula {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 11px;
            color: #888;
            flex-wrap: wrap;
        }
        
        .recipe-arrow {
            color: #e94560;
        }
        
        .recipe-tags {
            display: flex;
            gap: 5px;
            margin-top: 8px;
            flex-wrap: wrap;
        }
        
        .tag {
            font-size: 9px;
            padding: 2px 6px;
            background: #1a1a2e;
            border-radius: 3px;
            color: #aaa;
        }
        
        /* æ—¥å¿—åŒºåŸŸ */
        .log-panel {
            margin-top: 20px;
            background: #16213e;
            border-radius: 10px;
            padding: 15px;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .log-content {
            max-height: 150px;
            overflow-y: auto;
            font-size: 12px;
            line-height: 1.6;
            color: #aaa;
        }
        
        .log-entry {
            padding: 3px 0;
            border-bottom: 1px solid #0f3460;
        }
        
        .log-entry.success {
            color: #4ecca3;
        }
        
        .log-entry.discovery {
            color: #e94560;
            font-weight: bold;
        }
        
        /* æç¤º */
        .hint {
            text-align: center;
            color: #888;
            font-size: 12px;
            margin-top: 10px;
        }
        
        /* æ»šåŠ¨æ¡ */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #1a1a2e;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #533483;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #e94560;
        }
    </style>
</head>
<body>
    <h1>âš—ï¸ ç‚¼é‡‘æœ¯å£«çš„ç†”ç‚‰</h1>
    <p class="subtitle">æœºåˆ¶åŸå‹æ¼”ç¤º | ç‚¹å‡»ææ–™é€‰æ‹©ï¼Œå†ç‚¹å‡»æ§½ä½æ”¾å…¥</p>
    
    <div class="main-container">
        <!-- å·¦ä¾§ææ–™åº“ -->
        <div class="materials-panel">
            <div class="panel-title">ğŸ“¦ ææ–™åº“ï¼ˆæ— é™ï¼‰</div>
            
            <div class="material-category">
                <div class="category-name">é‡‘å±çŸ¿ç‰©</div>
                <div class="materials-grid">
                    <div class="material-card" data-material="hematite" onclick="selectMaterial('hematite')">
                        <div class="material-icon">ğŸª¨</div>
                        <div class="material-name">èµ¤é“çŸ¿</div>
                    </div>
                    <div class="material-card" data-material="pyrite" onclick="selectMaterial('pyrite')">
                        <div class="material-icon">âœ¨</div>
                        <div class="material-name">é»„é“çŸ¿</div>
                    </div>
                    <div class="material-card" data-material="malachite" onclick="selectMaterial('malachite')">
                        <div class="material-icon">ğŸŸ¢</div>
                        <div class="material-name">å­”é›€çŸ³</div>
                    </div>
                    <div class="material-card" data-material="bauxite" onclick="selectMaterial('bauxite')">
                        <div class="material-icon">ğŸŸ¤</div>
                        <div class="material-name">é“åœŸçŸ¿</div>
                    </div>
                    <div class="material-card" data-material="gold_sand" onclick="selectMaterial('gold_sand')">
                        <div class="material-icon">ğŸŒŸ</div>
                        <div class="material-name">é‡‘ç ‚</div>
                    </div>
                </div>
            </div>
            
            <div class="material-category">
                <div class="category-name">éé‡‘å±</div>
                <div class="materials-grid">
                    <div class="material-card" data-material="graphite" onclick="selectMaterial('graphite')">
                        <div class="material-icon">â¬›</div>
                        <div class="material-name">çŸ³å¢¨</div>
                    </div>
                    <div class="material-card" data-material="sulfur" onclick="selectMaterial('sulfur')">
                        <div class="material-icon">ğŸŸ¡</div>
                        <div class="material-name">ç¡«ç£º</div>
                    </div>
                    <div class="material-card" data-material="limestone" onclick="selectMaterial('limestone')">
                        <div class="material-icon">â¬œ</div>
                        <div class="material-name">çŸ³ç°çŸ³</div>
                    </div>
                    <div class="material-card" data-material="quartz" onclick="selectMaterial('quartz')">
                        <div class="material-icon">ğŸ’</div>
                        <div class="material-name">çŸ³è‹±ç ‚</div>
                    </div>
                    <div class="material-card" data-material="salt" onclick="selectMaterial('salt')">
                        <div class="material-icon">ğŸ§‚</div>
                        <div class="material-name">å²©ç›</div>
                    </div>
                    <div class="material-card" data-material="clay" onclick="selectMaterial('clay')">
                        <div class="material-icon">ğŸŸ«</div>
                        <div class="material-name">é»åœŸ</div>
                    </div>
                </div>
            </div>
            
            <div class="material-category">
                <div class="category-name">æ°”ä½“/å…¶ä»–</div>
                <div class="materials-grid">
                    <div class="material-card" data-material="air" onclick="selectMaterial('air')">
                        <div class="material-icon">ğŸ’¨</div>
                        <div class="material-name">ç©ºæ°”</div>
                    </div>
                    <div class="material-card" data-material="natural_gas" onclick="selectMaterial('natural_gas')">
                        <div class="material-icon">ğŸ”¥</div>
                        <div class="material-name">å¤©ç„¶æ°”</div>
                    </div>
                    <div class="material-card" data-material="water" onclick="selectMaterial('water')">
                        <div class="material-icon">ğŸ’§</div>
                        <div class="material-name">æ°´</div>
                    </div>
                    <div class="material-card" data-material="flux_dust" onclick="selectMaterial('flux_dust')">
                        <div class="material-icon">ğŸŒŒ</div>
                        <div class="material-name">è™šå¢ƒç²‰å°˜</div>
                    </div>
                </div>
            </div>
            
            <div class="material-category">
                <div class="category-name">äº§ç‰©ï¼ˆä¹Ÿå¯ä½œä¸ºåŸæ–™ï¼‰</div>
                <div class="materials-grid">
                    <div class="material-card" data-material="iron" onclick="selectMaterial('iron')">
                        <div class="material-icon">ğŸ”©</div>
                        <div class="material-name">ç”Ÿé“</div>
                    </div>
                    <div class="material-card" data-material="steel" onclick="selectMaterial('steel')">
                        <div class="material-icon">âš™ï¸</div>
                        <div class="material-name">é’¢</div>
                    </div>
                    <div class="material-card" data-material="copper" onclick="selectMaterial('copper')">
                        <div class="material-icon">ğŸŸ </div>
                        <div class="material-name">é“œ</div>
                    </div>
                    <div class="material-card" data-material="sulfuric_acid" onclick="selectMaterial('sulfuric_acid')">
                        <div class="material-icon">ğŸ§ª</div>
                        <div class="material-name">ç¡«é…¸</div>
                    </div>
                    <div class="material-card" data-material="silicon" onclick="selectMaterial('silicon')">
                        <div class="material-icon">ğŸ’»</div>
                        <div class="material-name">ç¡…</div>
                    </div>
                    <div class="material-card" data-material="flux_steel" onclick="selectMaterial('flux_steel')">
                        <div class="material-icon">ğŸ”®</div>
                        <div class="material-name">è™šå¢ƒé’¢</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ä¸­é—´åˆæˆé‡œ -->
        <div class="reactors-panel">
            <!-- åŸºç¡€ç†”ç‚¼é‡œ -->
            <div class="reactor" data-reactor="basic">
                <div class="reactor-header">
                    <span class="reactor-name">ğŸ”¥ åŸºç¡€ç†”ç‚¼é‡œ</span>
                    <span class="reactor-info">æ§½ä½: 2 | å¹¶è¡Œ: 1-2</span>
                </div>
                
                <div class="slots-container">
                    <div class="input-slots">
                        <div class="slot" data-slot="0" onclick="placeMaterial('basic', 0)">
                            <span class="slot-label">æ§½1</span>
                            <span class="slot-content">+</span>
                        </div>
                        <div class="slot" data-slot="1" onclick="placeMaterial('basic', 1)">
                            <span class="slot-label">æ§½2</span>
                            <span class="slot-content">+</span>
                        </div>
                    </div>
                    
                    <span class="arrow">â†’</span>
                    
                    <div class="output-slots" id="basic-output">
                        <div class="output-slot">
                            <span>?</span>
                        </div>
                    </div>
                </div>
                
                <div class="controls">
                    <div class="param-control">
                        <span class="param-label">æ¸©åº¦:</span>
                        <div class="param-buttons">
                            <button class="param-btn" onclick="setParam('basic', 'temp', 'low')">ä½</button>
                            <button class="param-btn active" onclick="setParam('basic', 'temp', 'medium')">ä¸­</button>
                            <button class="param-btn" onclick="setParam('basic', 'temp', 'high')">é«˜</button>
                        </div>
                    </div>
                    
                    <button class="action-btn" onclick="synthesize('basic')">å¼€å§‹åˆæˆ</button>
                    <button class="clear-btn" onclick="clearReactor('basic')">æ¸…ç©º</button>
                </div>
            </div>
            
            <!-- é«˜å‹åˆæˆé‡œ -->
            <div class="reactor" data-reactor="highpressure">
                <div class="reactor-header">
                    <span class="reactor-name">âš¡ é«˜å‹åˆæˆé‡œ</span>
                    <span class="reactor-info">æ§½ä½: 3 | å¹¶è¡Œ: 2-3</span>
                </div>
                
                <div class="slots-container">
                    <div class="input-slots">
                        <div class="slot" data-slot="0" onclick="placeMaterial('highpressure', 0)">
                            <span class="slot-label">æ§½1</span>
                            <span class="slot-content">+</span>
                        </div>
                        <div class="slot" data-slot="1" onclick="placeMaterial('highpressure', 1)">
                            <span class="slot-label">æ§½2</span>
                            <span class="slot-content">+</span>
                        </div>
                        <div class="slot" data-slot="2" onclick="placeMaterial('highpressure', 2)">
                            <span class="slot-label">æ§½3</span>
                            <span class="slot-content">+</span>
                        </div>
                    </div>
                    
                    <span class="arrow">â†’</span>
                    
                    <div class="output-slots" id="highpressure-output">
                        <div class="output-slot">
                            <span>?</span>
                        </div>
                        <div class="output-slot">
                            <span>?</span>
                        </div>
                    </div>
                </div>
                
                <div class="controls">
                    <div class="param-control">
                        <span class="param-label">æ¸©åº¦:</span>
                        <div class="param-buttons">
                            <button class="param-btn" onclick="setParam('highpressure', 'temp', 'low')">ä½</button>
                            <button class="param-btn" onclick="setParam('highpressure', 'temp', 'medium')">ä¸­</button>
                            <button class="param-btn active" onclick="setParam('highpressure', 'temp', 'high')">é«˜</button>
                            <button class="param-btn" onclick="setParam('highpressure', 'temp', 'extreme')">æé«˜</button>
                        </div>
                    </div>
                    
                    <div class="param-control">
                        <span class="param-label">å‹åŠ›:</span>
                        <div class="param-buttons">
                            <button class="param-btn" onclick="setParam('highpressure', 'pressure', 'low')">ä½</button>
                            <button class="param-btn" onclick="setParam('highpressure', 'pressure', 'medium')">ä¸­</button>
                            <button class="param-btn active" onclick="setParam('highpressure', 'pressure', 'high')">é«˜</button>
                        </div>
                    </div>
                    
                    <button class="action-btn" onclick="synthesize('highpressure')">å¼€å§‹åˆæˆ</button>
                    <button class="clear-btn" onclick="clearReactor('highpressure')">æ¸…ç©º</button>
                </div>
            </div>
            
            <!-- è™šå¢ƒè°ƒå’Œé‡œ -->
            <div class="reactor" data-reactor="flux">
                <div class="reactor-header">
                    <span class="reactor-name">ğŸŒŒ è™šå¢ƒè°ƒå’Œé‡œ</span>
                    <span class="reactor-info">æ§½ä½: 3 | å¹¶è¡Œ: 3 | éœ€è™šå¢ƒææ–™</span>
                </div>
                
                <div class="slots-container">
                    <div class="input-slots">
                        <div class="slot" data-slot="0" onclick="placeMaterial('flux', 0)">
                            <span class="slot-label">æ§½1</span>
                            <span class="slot-content">+</span>
                        </div>
                        <div class="slot" data-slot="1" onclick="placeMaterial('flux', 1)">
                            <span class="slot-label">æ§½2</span>
                            <span class="slot-content">+</span>
                        </div>
                        <div class="slot" data-slot="2" onclick="placeMaterial('flux', 2)">
                            <span class="slot-label">æ§½3</span>
                            <span class="slot-content">+</span>
                        </div>
                    </div>
                    
                    <span class="arrow">â†’</span>
                    
                    <div class="output-slots" id="flux-output">
                        <div class="output-slot">
                            <span>?</span>
                        </div>
                        <div class="output-slot">
                            <span>?</span>
                        </div>
                        <div class="output-slot">
                            <span>?</span>
                        </div>
                    </div>
                </div>
                
                <div class="controls">
                    <div class="param-control">
                        <span class="param-label">æ¸©åº¦:</span>
                        <div class="param-buttons">
                            <button class="param-btn" onclick="setParam('flux', 'temp', 'low')">ä½</button>
                            <button class="param-btn" onclick="setParam('flux', 'temp', 'medium')">ä¸­</button>
                            <button class="param-btn active" onclick="setParam('flux', 'temp', 'high')">é«˜</button>
                        </div>
                    </div>
                    
                    <div class="param-control">
                        <span class="param-label">è™šå¢ƒå…±é¸£:</span>
                        <div class="param-buttons">
                            <button class="param-btn" onclick="setParam('flux', 'flux', 'none')">å…³</button>
                            <button class="param-btn" onclick="setParam('flux', 'flux', 'low')">ä½</button>
                            <button class="param-btn active" onclick="setParam('flux', 'flux', 'high')">é«˜</button>
                        </div>
                    </div>
                    
                    <button class="action-btn" onclick="synthesize('flux')">å¼€å§‹åˆæˆ</button>
                    <button class="clear-btn" onclick="clearReactor('flux')">æ¸…ç©º</button>
                </div>
            </div>
        </div>
        
        <!-- å³ä¾§é…æ–¹å›¾é‰´ -->
        <div class="recipes-panel">
            <div class="panel-title">ğŸ“– é…æ–¹å›¾é‰´</div>
            
            <div class="recipes-filter">
                <button class="filter-btn active" onclick="filterRecipes('all')">å…¨éƒ¨</button>
                <button class="filter-btn" onclick="filterRecipes('discovered')">å·²å‘ç°</button>
                <button class="filter-btn" onclick="filterRecipes('metal')">é‡‘å±</button>
                <button class="filter-btn" onclick="filterRecipes('chemical')">åŒ–å·¥</button>
            </div>
            
            <div class="recipes-list" id="recipes-list">
                <!-- åŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
    </div>
    
    <!-- æ—¥å¿—é¢æ¿ -->
    <div class="log-panel">
        <div class="panel-title">ğŸ“ åˆæˆæ—¥å¿—</div>
        <div class="log-content" id="log-content">
            <div class="log-entry">æ¬¢è¿ä½¿ç”¨ç‚¼é‡‘æœ¯å£«çš„ç†”ç‚‰ï¼é€‰æ‹©ææ–™æ”¾å…¥åˆæˆé‡œï¼Œç‚¹å‡»"å¼€å§‹åˆæˆ"è¿›è¡Œå®éªŒã€‚</div>
        </div>
    </div>
    
    <p class="hint">ğŸ’¡ æç¤ºï¼šæ”¾å…¥3ç§ä¸åŒææ–™å¯æ¿€æ´»å¹¶è¡Œç”Ÿäº§ï¼Œä¸€æ¬¡è·å¾—å¤šä¸ªäº§ç‰©ï¼</p>

    <script>
        // ==================== ææ–™æ•°æ®åº“ ====================
        const materials = {
            // é‡‘å±çŸ¿ç‰©
            hematite: { name: 'èµ¤é“çŸ¿', icon: 'ğŸª¨', tags: ['metal', 'oxide', 'high_melt'] },
            pyrite: { name: 'é»„é“çŸ¿', icon: 'âœ¨', tags: ['metal', 'flammable', 'acidic'] },
            malachite: { name: 'å­”é›€çŸ³', icon: 'ğŸŸ¢', tags: ['metal', 'basic', 'brittle'] },
            bauxite: { name: 'é“åœŸçŸ¿', icon: 'ğŸŸ¤', tags: ['metal', 'basic', 'high_melt'] },
            gold_sand: { name: 'é‡‘ç ‚', icon: 'ğŸŒŸ', tags: ['metal', 'inert', 'high_density'] },
            
            // éé‡‘å±
            graphite: { name: 'çŸ³å¢¨', icon: 'â¬›', tags: ['nonmetal', 'flammable', 'conductive'] },
            sulfur: { name: 'ç¡«ç£º', icon: 'ğŸŸ¡', tags: ['nonmetal', 'flammable', 'acidic'] },
            limestone: { name: 'çŸ³ç°çŸ³', icon: 'â¬œ', tags: ['nonmetal', 'basic', 'high_melt'] },
            quartz: { name: 'çŸ³è‹±ç ‚', icon: 'ğŸ’', tags: ['nonmetal', 'high_melt', 'brittle'] },
            salt: { name: 'å²©ç›', icon: 'ğŸ§‚', tags: ['nonmetal', 'halogen', 'hygroscopic'] },
            clay: { name: 'é»åœŸ', icon: 'ğŸŸ«', tags: ['nonmetal', 'hygroscopic', 'plastic'] },
            
            // æ°”ä½“/å…¶ä»–
            air: { name: 'ç©ºæ°”', icon: 'ğŸ’¨', tags: ['gas', 'oxidizing', 'inert'] },
            natural_gas: { name: 'å¤©ç„¶æ°”', icon: 'ğŸ”¥', tags: ['gas', 'flammable', 'nonmetal'] },
            water: { name: 'æ°´', icon: 'ğŸ’§', tags: ['liquid', 'neutral', 'solvent'] },
            flux_dust: { name: 'è™šå¢ƒç²‰å°˜', icon: 'ğŸŒŒ', tags: ['flux', 'unstable', 'high_energy'] },
            
            // äº§ç‰©
            iron: { name: 'ç”Ÿé“', icon: 'ğŸ”©', tags: ['metal', 'product'] },
            steel: { name: 'é’¢', icon: 'âš™ï¸', tags: ['metal', 'product', 'high_strength'] },
            copper: { name: 'é“œ', icon: 'ğŸŸ ', tags: ['metal', 'product', 'conductive'] },
            sulfuric_acid: { name: 'ç¡«é…¸', icon: 'ğŸ§ª', tags: ['liquid', 'product', 'acidic', 'corrosive'] },
            silicon: { name: 'ç¡…', icon: 'ğŸ’»', tags: ['nonmetal', 'product', 'semiconductor'] },
            flux_steel: { name: 'è™šå¢ƒé’¢', icon: 'ğŸ”®', tags: ['metal', 'product', 'flux_contaminated'] },
            slag: { name: 'ç‚‰æ¸£', icon: 'ğŸ—¿', tags: ['waste', 'basic'] },
            co2: { name: 'COâ‚‚', icon: 'â˜ï¸', tags: ['gas', 'waste'] },
            mixture: { name: 'æ··åˆç‰©', icon: 'ğŸ“¦', tags: ['unrefined'] },
            flux_residue: { name: 'è™šå¢ƒæ®‹ç•™ç‰©', icon: 'âœ¨', tags: ['flux', 'research'] }
        };
        
        // ==================== é…æ–¹æ•°æ®åº“ ====================
        const recipes = [
            // é’¢é“ç±»
            {
                id: 'iron_basic',
                name: 'é«˜ç‚‰ç‚¼é“',
                inputs: ['hematite', 'graphite'],
                outputs: [
                    { material: 'iron', probability: 70, conditions: { temp: 'high' } },
                    { material: 'slag', probability: 25, conditions: { temp: 'high' } },
                    { material: 'co2', probability: 5, conditions: {} }
                ],
                category: 'metal',
                discovered: false
            },
            {
                id: 'steel_basic',
                name: 'ç‚¼é’¢',
                inputs: ['iron', 'graphite'],
                outputs: [
                    { material: 'steel', probability: 75, conditions: { temp: 'high' } },
                    { material: 'co2', probability: 20, conditions: { temp: 'high' } },
                    { material: 'iron', probability: 5, conditions: { temp: 'medium' } }
                ],
                category: 'metal',
                discovered: false
            },
            {
                id: 'flux_steel',
                name: 'è™šå¢ƒå¼ºåŒ–é’¢',
                inputs: ['iron', 'flux_dust'],
                outputs: [
                    { material: 'flux_steel', probability: 50, conditions: { flux: 'high' } },
                    { material: 'steel', probability: 30, conditions: { flux: 'low' } },
                    { material: 'flux_residue', probability: 15, conditions: { flux: 'high' } },
                    { material: 'mixture', probability: 5, conditions: {} }
                ],
                category: 'metal',
                discovered: false
            },
            {
                id: 'copper_smelt',
                name: 'ç‚¼é“œ',
                inputs: ['malachite', 'graphite'],
                outputs: [
                    { material: 'copper', probability: 80, conditions: { temp: 'high' } },
                    { material: 'co2', probability: 15, conditions: {} },
                    { material: 'slag', probability: 5, conditions: {} }
                ],
                category: 'metal',
                discovered: false
            },
            
            // åŒ–å·¥ç±»
            {
                id: 'sulfuric_contact',
                name: 'æ¥è§¦æ³•åˆ¶ç¡«é…¸',
                inputs: ['sulfur', 'air', 'water'],
                outputs: [
                    { material: 'sulfuric_acid', probability: 75, conditions: { temp: 'high' } },
                    { material: 'co2', probability: 20, conditions: {} },
                    { material: 'mixture', probability: 5, conditions: { temp: 'low' } }
                ],
                category: 'chemical',
                discovered: false
            },
            {
                id: 'sulfuric_pyrite',
                name: 'é»„é“çŸ¿åˆ¶ç¡«é…¸',
                inputs: ['pyrite', 'air', 'water'],
                outputs: [
                    { material: 'sulfuric_acid', probability: 60, conditions: { temp: 'high', pressure: 'high' } },
                    { material: 'hematite', probability: 25, conditions: { temp: 'high' } },
                    { material: 'co2', probability: 10, conditions: {} },
                    { material: 'mixture', probability: 5, conditions: {} }
                ],
                category: 'chemical',
                discovered: false
            },
            
            // ç¡…ç±»
            {
                id: 'silicon_rough',
                name: 'ç²—ç¡…åˆ¶å¤‡',
                inputs: ['quartz', 'graphite'],
                outputs: [
                    { material: 'silicon', probability: 70, conditions: { temp: 'extreme' } },
                    { material: 'co2', probability: 25, conditions: { temp: 'high' } },
                    { material: 'mixture', probability: 5, conditions: { temp: 'medium' } }
                ],
                category: 'chemical',
                discovered: false
            },
            {
                id: 'silicon_flux',
                name: 'è™šå¢ƒçº¯ç¡…',
                inputs: ['quartz', 'flux_dust'],
                outputs: [
                    { material: 'silicon', probability: 60, conditions: { flux: 'high' } },
                    { material: 'flux_residue', probability: 30, conditions: { flux: 'high' } },
                    { material: 'mixture', probability: 10, conditions: {} }
                ],
                category: 'chemical',
                discovered: false
            },
            
            // å…¶ä»–
            {
                id: 'gold_extract',
                name: 'æé‡‘',
                inputs: ['gold_sand', 'sulfuric_acid'],
                outputs: [
                    { material: 'gold_sand', probability: 90, conditions: { temp: 'medium' } },
                    { material: 'mixture', probability: 10, conditions: { temp: 'high' } }
                ],
                category: 'metal',
                discovered: false
            }
        ];
        
        // ==================== çŠ¶æ€ç®¡ç† ====================
        let selectedMaterial = null;
        const reactorStates = {
            basic: { slots: [null, null], params: { temp: 'medium' }, outputs: [] },
            highpressure: { slots: [null, null, null], params: { temp: 'high', pressure: 'high' }, outputs: [] },
            flux: { slots: [null, null, null], params: { temp: 'high', flux: 'high' }, outputs: [] }
        };
        
        // ==================== æ ¸å¿ƒå‡½æ•° ====================
        
        // é€‰æ‹©ææ–™
        function selectMaterial(materialId) {
            selectedMaterial = materialId;
            
            // æ›´æ–°UI
            document.querySelectorAll('.material-card').forEach(card => {
                card.classList.remove('selected');
            });
            document.querySelector(`[data-material="${materialId}"]`).classList.add('selected');
            
            log(`é€‰æ‹©äº†: ${materials[materialId].name}`);
        }
        
        // æ”¾å…¥ææ–™
        function placeMaterial(reactorId, slotIndex) {
            if (!selectedMaterial) {
                log('è¯·å…ˆé€‰æ‹©ä¸€ç§ææ–™ï¼', 'error');
                return;
            }
            
            reactorStates[reactorId].slots[slotIndex] = selectedMaterial;
            updateReactorUI(reactorId);
            log(`å°† ${materials[selectedMaterial].name} æ”¾å…¥ ${reactorId === 'basic' ? 'åŸºç¡€ç†”ç‚¼é‡œ' : reactorId === 'highpressure' ? 'é«˜å‹åˆæˆé‡œ' : 'è™šå¢ƒè°ƒå’Œé‡œ'} æ§½${slotIndex + 1}`);
        }
        
        // è®¾ç½®å‚æ•°
        function setParam(reactorId, param, value) {
            reactorStates[reactorId].params[param] = value;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            const reactor = document.querySelector(`[data-reactor="${reactorId}"]`);
            reactor.querySelectorAll(`.param-btn`).forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            log(`è®¾ç½® ${reactorId === 'basic' ? 'åŸºç¡€ç†”ç‚¼é‡œ' : reactorId === 'highpressure' ? 'é«˜å‹åˆæˆé‡œ' : 'è™šå¢ƒè°ƒå’Œé‡œ'} å‚æ•°: ${param} = ${value}`);
        }
        
        // åˆæˆï¼
        function synthesize(reactorId) {
            const state = reactorStates[reactorId];
            const filledSlots = state.slots.filter(s => s !== null);
            
            if (filledSlots.length === 0) {
                log('è¯·å…ˆæ”¾å…¥ææ–™ï¼', 'error');
                return;
            }
            
            // è®¡ç®—å¹¶è¡Œåº¦
            const uniqueMaterials = [...new Set(filledSlots)];
            let parallelism = 1;
            if (reactorId === 'basic') {
                parallelism = uniqueMaterials.length >= 2 ? 2 : 1;
            } else if (reactorId === 'highpressure') {
                parallelism = uniqueMaterials.length >= 3 ? 3 : 2;
            } else if (reactorId === 'flux') {
                parallelism = uniqueMaterials.length >= 3 ? 3 : 2;
            }
            
            // åŒ¹é…é…æ–¹
            const matchedRecipes = matchRecipes(filledSlots, state.params);
            
            if (matchedRecipes.length === 0) {
                // æ— åŒ¹é…é…æ–¹ï¼Œäº§å‡ºæ··åˆç‰©
                state.outputs = Array(parallelism).fill('mixture');
                log(`æœªæ‰¾åˆ°åŒ¹é…é…æ–¹ï¼Œäº§å‡º ${parallelism} ä¸ªæ··åˆç‰©`);
            } else {
                // æŒ‰æƒé‡éšæœºæŠ½å–
                state.outputs = [];
                const discoveredRecipes = [];
                
                for (let i = 0; i < parallelism; i++) {
                    const result = drawFromPool(matchedRecipes, state.params);
                    state.outputs.push(result.material);
                    
                    // æ ‡è®°é…æ–¹ä¸ºå·²å‘ç°
                    const recipe = matchedRecipes.find(r => r.outputs.some(o => o.material === result.material));
                    if (recipe && !recipe.discovered) {
                        recipe.discovered = true;
                        discoveredRecipes.push(recipe.name);
                    }
                }
                
                if (discoveredRecipes.length > 0) {
                    log(`ğŸ‰ å‘ç°äº†æ–°é…æ–¹: ${[...new Set(discoveredRecipes)].join(', ')}ï¼`, 'discovery');
                }
                
                log(`åˆæˆæˆåŠŸï¼äº§å‡º: ${state.outputs.map(o => materials[o].name).join(', ')}`, 'success');
            }
            
            updateReactorUI(reactorId);
            updateRecipesList();
        }
        
        // åŒ¹é…é…æ–¹
        function matchRecipes(inputs, params) {
            return recipes.filter(recipe => {
                // æ£€æŸ¥è¾“å…¥æ˜¯å¦åŒ¹é…ï¼ˆå…è®¸è¶…é›†ï¼‰
                const recipeInputs = [...recipe.inputs].sort();
                const actualInputs = [...inputs].sort();
                
                // æ£€æŸ¥æ˜¯å¦åŒ…å«æ‰€æœ‰å¿…éœ€è¾“å…¥
                for (let input of recipeInputs) {
                    if (!actualInputs.includes(input)) {
                        return false;
                    }
                }
                
                // æ£€æŸ¥å‚æ•°æ¡ä»¶ï¼ˆå¦‚æœæœ‰ï¼‰
                for (let output of recipe.outputs) {
                    if (output.conditions) {
                        const conditions = output.conditions;
                        let match = true;
                        for (let [key, value] of Object.entries(conditions)) {
                            if (params[key] !== value) {
                                match = false;
                                break;
                            }
                        }
                        if (match) return true;
                    } else {
                        return true;
                    }
                }
                
                return true;
            });
        }
        
        // ä»äº§ç‰©æ± æŠ½å–
        function drawFromPool(matchedRecipes, params) {
            // æ„å»ºäº§ç‰©æ± 
            let pool = [];
            
            for (let recipe of matchedRecipes) {
                for (let output of recipe.outputs) {
                    let weight = output.probability;
                    
                    // å‚æ•°åŒ¹é…åŠ æˆ
                    if (output.conditions) {
                        let matchCount = 0;
                        for (let [key, value] of Object.entries(output.conditions)) {
                            if (params[key] === value) {
                                matchCount++;
                            }
                        }
                        weight *= (1 + matchCount * 0.3); // å‚æ•°åŒ¹é…åŠ æˆ30%
                    }
                    
                    // å·²å‘ç°é…æ–¹åŠ æˆ
                    if (recipe.discovered) {
                        weight *= 1.2; // 20%åŠ æˆ
                    }
                    
                    pool.push({
                        material: output.material,
                        weight: weight,
                        recipe: recipe
                    });
                }
            }
            
            // æŒ‰æƒé‡éšæœºæŠ½å–
            const totalWeight = pool.reduce((sum, item) => sum + item.weight, 0);
            let random = Math.random() * totalWeight;
            
            for (let item of pool) {
                random -= item.weight;
                if (random <= 0) {
                    return item;
                }
            }
            
            return pool[0];
        }
        
        // æ¸…ç©ºåˆæˆé‡œ
        function clearReactor(reactorId) {
            reactorStates[reactorId].slots = reactorStates[reactorId].slots.map(() => null);
            reactorStates[reactorId].outputs = [];
            updateReactorUI(reactorId);
            log(`æ¸…ç©º ${reactorId === 'basic' ? 'åŸºç¡€ç†”ç‚¼é‡œ' : reactorId === 'highpressure' ? 'é«˜å‹åˆæˆé‡œ' : 'è™šå¢ƒè°ƒå’Œé‡œ'}`);
        }
        
        // æ›´æ–°åˆæˆé‡œUI
        function updateReactorUI(reactorId) {
            const state = reactorStates[reactorId];
            const reactor = document.querySelector(`[data-reactor="${reactorId}"]`);
            
            // æ›´æ–°è¾“å…¥æ§½
            state.slots.forEach((material, index) => {
                const slot = reactor.querySelector(`[data-slot="${index}"]`);
                if (material) {
                    slot.classList.add('filled');
                    slot.innerHTML = `
                        <span class="slot-label">æ§½${index + 1}</span>
                        <span class="slot-content">${materials[material].icon}</span>
                        <span class="slot-material">${materials[material].name}</span>
                    `;
                } else {
                    slot.classList.remove('filled');
                    slot.innerHTML = `
                        <span class="slot-label">æ§½${index + 1}</span>
                        <span class="slot-content">+</span>
                    `;
                }
            });
            
            // æ›´æ–°è¾“å‡ºæ§½
            const outputContainer = document.getElementById(`${reactorId}-output`);
            if (state.outputs.length > 0) {
                outputContainer.innerHTML = state.outputs.map(out => `
                    <div class="output-slot has-result">
                        <div style="font-size: 24px;">${materials[out].icon}</div>
                        <div style="font-size: 10px;">${materials[out].name}</div>
                    </div>
                `).join('');
            } else {
                const defaultSlots = reactorId === 'basic' ? 1 : reactorId === 'highpressure' ? 2 : 3;
                outputContainer.innerHTML = Array(defaultSlots).fill(0).map(() => `
                    <div class="output-slot">
                        <span>?</span>
                    </div>
                `).join('');
            }
        }
        
        // æ›´æ–°é…æ–¹åˆ—è¡¨
        function updateRecipesList() {
            const list = document.getElementById('recipes-list');
            const filter = document.querySelector('.filter-btn.active').textContent;
            
            let filteredRecipes = recipes;
            if (filter === 'å·²å‘ç°') {
                filteredRecipes = recipes.filter(r => r.discovered);
            } else if (filter === 'é‡‘å±') {
                filteredRecipes = recipes.filter(r => r.category === 'metal');
            } else if (filter === 'åŒ–å·¥') {
                filteredRecipes = recipes.filter(r => r.category === 'chemical');
            }
            
            list.innerHTML = filteredRecipes.map(recipe => {
                const inputNames = recipe.inputs.map(i => materials[i]?.name || i).join(' + ');
                const outputNames = recipe.outputs.map(o => `${materials[o.material]?.name || o.material}(${o.probability}%)`).join(' / ');
                
                return `
                    <div class="recipe-item ${recipe.discovered ? 'discovered' : 'undiscovered'}">
                        <div class="recipe-header">
                            <span class="recipe-name">${recipe.discovered ? 'âœ“ ' : '? '}${recipe.name}</span>
                            <span class="recipe-probability">${recipe.discovered ? 'å·²å‘ç°' : 'æœªå‘ç°'}</span>
                        </div>
                        <div class="recipe-formula">
                            ${inputNames} <span class="recipe-arrow">â†’</span> ${outputNames}
                        </div>
                        <div class="recipe-tags">
                            ${recipe.inputs.map(i => `<span class="tag">${materials[i]?.name || i}</span>`).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // ç­›é€‰é…æ–¹
        function filterRecipes(type) {
            document.querySelectorAll('.recipes-filter .filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            updateRecipesList();
        }
        
        // æ—¥å¿—
        function log(message, type = '') {
            const logContent = document.getElementById('log-content');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logContent.insertBefore(entry, logContent.firstChild);
            
            // é™åˆ¶æ—¥å¿—æ•°é‡
            while (logContent.children.length > 50) {
                logContent.removeChild(logContent.lastChild);
            }
        }
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            updateRecipesList();
            log('ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆã€‚ææ–™åº“å·²åŠ è½½ ' + Object.keys(materials).length + ' ç§ææ–™');
            log('é…æ–¹æ•°æ®åº“å·²åŠ è½½ ' + recipes.length + ' ä¸ªé…æ–¹');
        });
    </script>
</body>
</html>
